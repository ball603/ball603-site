<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="The Bash - New Hampshire's Largest Holiday Basketball Tournament featuring 28 teams and 50 games">
  <meta name="theme-color" content="#1a1a2e">
  <title>The Bash 2025 | Ball603</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/logos/TheBash.png">
  <link rel="apple-touch-icon" href="/logos/TheBash.png">
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Shared Styles -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/the-bash.css">
  
  <!-- Open Graph -->
  <meta property="og:title" content="The Bash 2025 | Ball603">
  <meta property="og:description" content="New Hampshire's Largest Holiday Basketball Tournament - 28 teams, 50 games, December 26-30">
  <meta property="og:image" content="https://ball603.com/logos/TheBash.png">
  <meta property="og:url" content="https://ball603.com/the-bash">
</head>
<body class="bash-landing">
  <!-- Continue to Main Site Banner -->
  <div class="bash-continue-banner" id="continueBanner">
    <span>You're viewing The Bash tournament site</span>
    <a href="/" class="bash-continue-btn" onclick="dismissBashBanner()">Continue to Ball603.com &rarr;</a>
  </div>
  
  <!-- Header -->
  <header class="bash-landing-header">
    <div class="bash-landing-header-inner">
      <a href="/the-bash" class="bash-landing-logo">
        <img src="/logos/TheBash.png" alt="The Bash" style="height: 40px;">
      </a>
      <nav class="bash-landing-nav">
        <a href="#schedule" class="bash-nav-link">Schedule</a>
        <a href="#brackets" class="bash-nav-link">Brackets</a>
        <a href="#stories" class="bash-nav-link">Stories</a>
        <a href="#history" class="bash-nav-link">History</a>
      </nav>
      <a href="/" class="bash-main-site-link">Ball603.com</a>
    </div>
  </header>

  <!-- Hero Section with Snow -->
  <section class="bash-hero" id="bashHero">
    <div class="snow-container" id="snowContainer"></div>
    <div class="bash-hero-content">
      <div class="bash-hero-tagline">New Hampshire's Largest Holiday Tournament</div>
      <img src="/logos/TheBash.png" alt="The Bash" class="bash-hero-logo">
      <div class="bash-hero-dates">December 26-30, 2025</div>
      <div class="bash-hero-venue">Farmington High School</div>
      <div class="bash-hero-stats">
        <div class="bash-hero-stat">
          <span class="stat-value">28</span>
          <span class="stat-label">Teams</span>
        </div>
        <div class="bash-hero-stat">
          <span class="stat-value">50</span>
          <span class="stat-label">Games</span>
        </div>
        <div class="bash-hero-stat">
          <span class="stat-value">45+</span>
          <span class="stat-label">Years</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Recap (if exists) -->
  <section class="bash-featured" id="bashFeatured" style="display: none;">
    <div class="bash-featured-inner">
      <div class="bash-featured-card" id="featuredRecap">
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="bash-landing-main">
    <!-- Today's Games -->
    <section class="bash-today" id="bashToday">
      <div class="bash-section-header">
        <h2 class="bash-section-title" id="todayTitle">Today's Games</h2>
        <a href="#schedule" class="bash-section-link">Full Schedule &rarr;</a>
      </div>
      <div class="bash-today-scroll" id="todayGames">
        <div class="bash-loading">Loading games...</div>
      </div>
    </section>

    <!-- Stories Feed -->
    <section class="bash-stories" id="stories">
      <div class="bash-section-header">
        <h2 class="bash-section-title">Latest Stories</h2>
      </div>
      <div class="bash-stories-grid" id="bashStoriesGrid">
        <div class="bash-loading">Loading stories...</div>
      </div>
    </section>

    <!-- Quick Links -->
    <section class="bash-quicklinks">
      <a href="#schedule" class="bash-quicklink" data-tab="schedule">
        <span class="bash-quicklink-icon">&#128197;</span>
        <span class="bash-quicklink-text">Schedule & Results</span>
      </a>
      <a href="#boys-bracket" class="bash-quicklink" data-tab="boys-bracket">
        <span class="bash-quicklink-icon">&#127936;</span>
        <span class="bash-quicklink-text">Boys Bracket</span>
      </a>
      <a href="#girls-bracket" class="bash-quicklink" data-tab="girls-bracket">
        <span class="bash-quicklink-icon">&#127936;</span>
        <span class="bash-quicklink-text">Girls Bracket</span>
      </a>
      <a href="#history" class="bash-quicklink" data-tab="history">
        <span class="bash-quicklink-icon">&#127942;</span>
        <span class="bash-quicklink-text">History & Records</span>
      </a>
    </section>

    <!-- Tab Content Area -->
    <section class="bash-tabs-section" id="bashTabsSection">
      <!-- Tab Navigation -->
      <div class="bash-tabs" id="schedule">
        <button class="bash-tab active" data-tab="schedule">Schedule</button>
        <button class="bash-tab" data-tab="boys-bracket" id="boys-bracket">Boys Bracket</button>
        <button class="bash-tab" data-tab="girls-bracket" id="girls-bracket">Girls Bracket</button>
        <button class="bash-tab" data-tab="history" id="history">History</button>
      </div>

      <!-- Schedule Panel -->
      <div class="bash-panel active" id="schedulePanel">
        <div class="bash-schedule-filters">
          <button class="bash-filter-btn active" data-filter="all">ALL GAMES</button>
          <select class="bash-filter-select" id="divisionFilter">
            <option value="">Division</option>
            <option value="Boys">Boys</option>
            <option value="Girls">Girls</option>
          </select>
          <select class="bash-filter-select" id="dayFilter">
            <option value="">Day</option>
            <option value="Dec 26">Dec 26</option>
            <option value="Dec 27">Dec 27</option>
            <option value="Dec 28">Dec 28</option>
            <option value="Dec 29">Dec 29</option>
            <option value="Dec 30">Dec 30</option>
          </select>
        </div>
        <div class="bash-schedule-table" id="scheduleTable">
          <div class="bash-loading">Loading schedule...</div>
        </div>
      </div>

      <!-- Boys Bracket Panel -->
      <div class="bash-panel" id="boys-bracketPanel">
        <h3 class="bash-bracket-title">Boys Championship Bracket</h3>
        <div class="bash-bracket boys-bracket" id="boysBracket">
          <div class="bash-loading">Loading bracket...</div>
        </div>
      </div>

      <!-- Girls Bracket Panel -->
      <div class="bash-panel" id="girls-bracketPanel">
        <h3 class="bash-bracket-title">Girls Championship Bracket</h3>
        <div class="bash-bracket girls-bracket" id="girlsBracket">
          <div class="bash-loading">Loading bracket...</div>
        </div>
      </div>

      <!-- History Panel -->
      <div class="bash-panel" id="historyPanel">
        <div class="bash-history-tabs">
          <button class="bash-history-tab active" data-history="champions">Champions</button>
          <button class="bash-history-tab" data-history="awards">Awards</button>
        </div>
        <div class="bash-history-content" id="historyContent">
          <div class="bash-loading">Loading history...</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bash-footer">
    <div class="bash-footer-inner">
      <div class="bash-footer-brand">
        <img src="/logos/TheBash.png" alt="The Bash" style="height: 50px; margin-bottom: 10px;">
        <p>New Hampshire's Largest Holiday Tournament</p>
        <p style="font-size: 12px; opacity: 0.7;">Est. 1979 - Farmington, NH</p>
      </div>
      <div class="bash-footer-links">
        <a href="/">Ball603.com</a>
        <a href="/schedule">NH Schedule</a>
        <a href="/standings">Standings</a>
      </div>
      <div class="bash-footer-powered">
        <span>Powered by</span>
        <a href="/">
          <img src="/logo.png" alt="Ball603" style="height: 30px; vertical-align: middle;">
        </a>
      </div>
    </div>
  </footer>

  <!-- Data -->
  <script src="/the-bash-data.js"></script>
  
  <!-- Scripts -->
  <script>
    // Supabase client
    const supabaseUrl = 'https://qdnmwdvvzxmfsacnnfvs.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkbm13ZHZ2enhtZnNhY25uZnZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMwOTk2ODIsImV4cCI6MjA0ODY3NTY4Mn0.GinXXsLYNFE7denjGRC5SsOlbOpaHYkxVDTpto6WBDA';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      initSnow();
      await loadBashStories();
      loadTodayGames();
      initTabs();
      initSchedule();
      initBrackets();
      initHistory();
      checkBannerDismissed();
    });

    // Banner management
    function dismissBashBanner() {
      localStorage.setItem('bashBannerDismissed', 'true');
      document.getElementById('continueBanner').style.display = 'none';
    }

    function checkBannerDismissed() {
      if (localStorage.getItem('bashBannerDismissed') === 'true') {
        // Reset after 1 hour
        setTimeout(() => localStorage.removeItem('bashBannerDismissed'), 3600000);
      }
    }

    // Snow effect
    function initSnow() {
      const container = document.getElementById('snowContainer');
      if (!container) return;

      function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.innerHTML = '&#10052;';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
        snowflake.style.opacity = Math.random() * 0.8 + 0.2;
        snowflake.style.fontSize = (Math.random() * 15 + 10) + 'px';
        container.appendChild(snowflake);

        setTimeout(() => snowflake.remove(), 5000);
      }

      // Initial burst
      for (let i = 0; i < 30; i++) {
        setTimeout(() => createSnowflake(), i * 100);
      }

      // Recurring snow
      setInterval(() => {
        for (let i = 0; i < 5; i++) {
          setTimeout(() => createSnowflake(), i * 200);
        }
      }, 3000);
    }

    // Load stories from Supabase
    async function loadBashStories() {
      try {
        // Load featured recap first
        const { data: recaps } = await supabase
          .from('articles')
          .select('*')
          .contains('tags', ['bash-recap'])
          .eq('status', 'published')
          .order('published_at', { ascending: false })
          .limit(1);

        if (recaps && recaps.length > 0) {
          const recap = recaps[0];
          document.getElementById('bashFeatured').style.display = 'block';
          document.getElementById('featuredRecap').innerHTML = `
            <div class="bash-featured-label">LATEST RECAP</div>
            <h2 class="bash-featured-title">${recap.title}</h2>
            <p class="bash-featured-excerpt">${recap.excerpt || ''}</p>
            <a href="/article/${recap.slug}" class="bash-featured-link">Read Full Recap &rarr;</a>
          `;
        }

        // Load all bash stories
        const { data: stories } = await supabase
          .from('articles')
          .select('*')
          .or('tags.cs.{bash-game},tags.cs.{bash-recap}')
          .eq('status', 'published')
          .order('published_at', { ascending: false })
          .limit(12);

        const grid = document.getElementById('bashStoriesGrid');
        if (!stories || stories.length === 0) {
          grid.innerHTML = '<div class="bash-no-stories">No stories yet. Check back during the tournament!</div>';
          return;
        }

        grid.innerHTML = stories.map(story => `
          <a href="/article/${story.slug}" class="bash-story-card">
            ${story.featured_image ? `<img src="${story.featured_image}" alt="" class="bash-story-image">` : ''}
            <div class="bash-story-content">
              <span class="bash-story-tag">${story.tags?.includes('bash-recap') ? 'RECAP' : 'GAME'}</span>
              <h3 class="bash-story-title">${story.title}</h3>
              <p class="bash-story-excerpt">${story.excerpt || ''}</p>
              <span class="bash-story-date">${new Date(story.published_at).toLocaleDateString()}</span>
            </div>
          </a>
        `).join('');

      } catch (err) {
        console.error('Error loading stories:', err);
        document.getElementById('bashStoriesGrid').innerHTML = '<div class="bash-error">Error loading stories</div>';
      }
    }

    // Today's games
    function loadTodayGames() {
      if (typeof BASH_DATA === 'undefined') return;

      const today = new Date();
      const dates = ['Dec 26', 'Dec 27', 'Dec 28', 'Dec 29', 'Dec 30'];
      
      // Find current tournament day or use Dec 26 as default
      let currentDay = 'Dec 26';
      const month = today.getMonth();
      const day = today.getDate();
      
      if (month === 11 && day >= 26 && day <= 30) {
        currentDay = 'Dec ' + day;
      }

      document.getElementById('todayTitle').textContent = currentDay + ' Games';

      const games = BASH_DATA.schedule.filter(g => g.date === currentDay && !g.special);
      const container = document.getElementById('todayGames');

      if (games.length === 0) {
        container.innerHTML = '<div class="bash-no-games">No games scheduled</div>';
        return;
      }

      container.innerHTML = games.map(g => {
        const hasScore = g.awayScore !== null && g.homeScore !== null;
        return `
          <div class="bash-today-game">
            <div class="bash-today-time">${g.time}</div>
            <div class="bash-today-teams">
              <div class="bash-today-team ${hasScore && g.awayScore > g.homeScore ? 'winner' : ''}">
                <span class="team-name">${g.away}</span>
                ${hasScore ? `<span class="team-score">${g.awayScore}</span>` : ''}
              </div>
              <div class="bash-today-team ${hasScore && g.homeScore > g.awayScore ? 'winner' : ''}">
                <span class="team-name">${g.home}</span>
                ${hasScore ? `<span class="team-score">${g.homeScore}</span>` : ''}
              </div>
            </div>
            <div class="bash-today-meta">
              <span class="bash-today-div">${g.division || ''}</span>
              <span class="bash-today-site">${g.site || ''}</span>
            </div>
            ${g.recap ? `<a href="${g.recap}" class="bash-today-recap">Recap</a>` : ''}
          </div>
        `;
      }).join('');
    }

    // Tab functionality
    function initTabs() {
      document.querySelectorAll('.bash-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;
          
          document.querySelectorAll('.bash-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.bash-panel').forEach(p => p.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(tabName + 'Panel').classList.add('active');
        });
      });

      // Quick links
      document.querySelectorAll('.bash-quicklink').forEach(link => {
        link.addEventListener('click', (e) => {
          const tabName = link.dataset.tab;
          document.querySelector(`.bash-tab[data-tab="${tabName}"]`)?.click();
        });
      });
    }

    // Schedule initialization
    function initSchedule() {
      if (typeof BASH_DATA === 'undefined') return;
      renderSchedule();

      document.getElementById('divisionFilter').addEventListener('change', renderSchedule);
      document.getElementById('dayFilter').addEventListener('change', renderSchedule);
      document.querySelector('.bash-filter-btn[data-filter="all"]').addEventListener('click', () => {
        document.getElementById('divisionFilter').value = '';
        document.getElementById('dayFilter').value = '';
        renderSchedule();
      });
    }

    function renderSchedule() {
      const divFilter = document.getElementById('divisionFilter').value;
      const dayFilter = document.getElementById('dayFilter').value;

      let games = BASH_DATA.schedule.filter(g => !g.special);
      if (divFilter) games = games.filter(g => g.division === divFilter);
      if (dayFilter) games = games.filter(g => g.date === dayFilter);

      const container = document.getElementById('scheduleTable');
      
      if (games.length === 0) {
        container.innerHTML = '<div class="bash-no-games">No games match filters</div>';
        return;
      }

      // Group by date
      const byDate = {};
      games.forEach(g => {
        if (!byDate[g.date]) byDate[g.date] = [];
        byDate[g.date].push(g);
      });

      let html = '';
      Object.keys(byDate).forEach(date => {
        html += `<div class="bash-schedule-date">${date}</div>`;
        html += '<div class="bash-schedule-games">';
        byDate[date].forEach(g => {
          const hasScore = g.awayScore !== null && g.homeScore !== null;
          html += `
            <div class="bash-schedule-row">
              <div class="bash-schedule-time">${g.time}</div>
              <div class="bash-schedule-matchup">
                <span class="bash-team away ${hasScore && g.awayScore > g.homeScore ? 'winner' : ''}">${g.away}</span>
                <span class="bash-vs">${hasScore ? g.awayScore + '-' + g.homeScore : 'vs'}</span>
                <span class="bash-team home ${hasScore && g.homeScore > g.awayScore ? 'winner' : ''}">${g.home}</span>
              </div>
              <div class="bash-schedule-info">
                <span class="bash-div">${g.division || ''}</span>
                <span class="bash-site">${g.site || ''}</span>
              </div>
              <div class="bash-schedule-coverage">
                ${g.recap ? '<a href="' + g.recap + '">Recap</a>' : ''}
                ${g.photos ? '<a href="' + g.photos + '">Photos</a>' : ''}
              </div>
            </div>
          `;
        });
        html += '</div>';
      });

      container.innerHTML = html;
    }

    // Brackets
    function initBrackets() {
      // Simplified bracket rendering - would need actual bracket data
      document.getElementById('boysBracket').innerHTML = '<div class="bash-bracket-placeholder">Boys bracket will be updated as games are played</div>';
      document.getElementById('girlsBracket').innerHTML = '<div class="bash-bracket-placeholder">Girls bracket will be updated as games are played</div>';
    }

    // History
    function initHistory() {
      if (typeof BASH_DATA === 'undefined') return;

      document.querySelectorAll('.bash-history-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.bash-history-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          renderHistory(tab.dataset.history);
        });
      });

      renderHistory('champions');
    }

    function renderHistory(type) {
      const container = document.getElementById('historyContent');
      
      if (type === 'champions') {
        const champs = BASH_DATA.champions || [];
        container.innerHTML = `
          <table class="bash-history-table">
            <thead>
              <tr>
                <th>Year</th>
                <th>Division</th>
                <th>Champion</th>
                <th>Score</th>
                <th>Runner-Up</th>
              </tr>
            </thead>
            <tbody>
              ${champs.map(c => `
                <tr>
                  <td>${c.year}</td>
                  <td>${c.gender}</td>
                  <td class="winner">${c.champion}</td>
                  <td>${c.championScore}-${c.runnerUpScore}${c.overtime ? ' OT' : ''}</td>
                  <td>${c.runnerUp}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } else {
        const awards = BASH_DATA.awards || [];
        container.innerHTML = `
          <table class="bash-history-table">
            <thead>
              <tr>
                <th>Year</th>
                <th>Division</th>
                <th>Award</th>
                <th>Recipient</th>
                <th>School</th>
              </tr>
            </thead>
            <tbody>
              ${awards.map(a => `
                <tr>
                  <td>${a.year}</td>
                  <td>${a.gender}</td>
                  <td>${a.award}</td>
                  <td>${a.name || '(Team)'}</td>
                  <td>${a.school}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      }
    }
  </script>
</body>
</html>
