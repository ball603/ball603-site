<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="The Bash - New Hampshire's Largest Holiday Basketball Tournament featuring 28 teams and 50 games">
  <meta name="theme-color" content="#1a1a2e">
  <title>The Bash 2025 | Ball603</title>
  <script>window.BASH_PAGE_VERSION = '2024.12.21.v4';</script>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/logos/TheBash.png">
  <link rel="apple-touch-icon" href="/logos/TheBash.png">
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S4BN80729K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S4BN80729K');
  </script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0"></script>
  
  <!-- Shared Styles -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/the-bash.css">
  
  <!-- Additional Story Styles -->
  <style>
    .bash-story-image {
      aspect-ratio: 16 / 9;
      background-size: cover;
      background-position: center;
      background-color: #1a1a2e;
    }
    .bash-story-content {
      padding: 16px;
    }
    .bash-story-date {
      font-size: 12px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .bash-story-title {
      margin: 8px 0;
      font-size: 16px;
      font-weight: 600;
      color: #1a1a2e;
      line-height: 1.3;
    }
    .bash-story-excerpt {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
      margin: 0;
    }
    .bash-loading {
      text-align: center;
      padding: 40px;
      color: #888;
    }
    
    /* Quick Nav Pills - Override default quicklinks */
    .bash-quicklinks {
      display: flex !important;
      grid-template-columns: unset !important;
      background: transparent !important;
      padding: 0 20px 20px 20px !important;
      margin: 0 auto !important;
      max-width: 1200px !important;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .bash-quicklinks::-webkit-scrollbar {
      display: none;
    }
    .bash-quicklinks-inner {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      gap: 12px;
      min-width: max-content;
      margin: 0 auto;
    }
    .bash-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: white;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 600;
      color: #1a1a2e;
      text-decoration: none;
      white-space: nowrap;
      border: 2px solid #e0e0e0;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      flex-shrink: 0;
    }
    .bash-pill:hover {
      border-color: #f57c00;
      color: #f57c00;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .bash-pill span {
      font-size: 18px;
    }
    
    /* Reduce space above pills */
    .bash-today {
      margin-bottom: 20px !important;
    }
    
    /* History table - make scrollable like schedule */
    .bash-history-table {
      min-width: 600px;
    }
    .bash-history-content {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    /* Mobile Dark Theme */
    @media (max-width: 768px) {
      /* Dark background for entire page */
      .bash-landing {
        background: #1a1a2e !important;
      }
      .bash-landing-main {
        background: #1a1a2e !important;
      }
      
      /* Pills - dark theme */
      .bash-quicklinks {
        padding: 0 15px 15px 15px !important;
      }
      .bash-quicklinks-inner {
        justify-content: flex-start;
      }
      .bash-pill {
        padding: 8px 14px;
        font-size: 12px;
        background: #2d2d44;
        border-color: #3d3d5c;
        color: white;
      }
      .bash-pill:hover {
        background: #3d3d5c;
        border-color: #f57c00;
        color: #f57c00;
      }
      .bash-pill span {
        font-size: 14px;
      }
      
      /* Stories section - dark theme */
      .bash-stories {
        background: transparent;
      }
      .bash-section-title {
        color: white !important;
      }
      .bash-section-link {
        color: #f57c00 !important;
      }
      .bash-story-card {
        background: #2d2d44 !important;
      }
      .bash-story-title {
        color: white !important;
      }
      .bash-story-excerpt {
        color: rgba(255,255,255,0.7) !important;
      }
      .bash-story-date {
        color: #f57c00 !important;
      }
      
      /* Tabs section - dark theme */
      .bash-tabs-section {
        background: #2d2d44 !important;
        box-shadow: none !important;
      }
      .bash-panel {
        background: transparent !important;
      }
      .bash-tabs {
        border-bottom-color: #3d3d5c !important;
      }
      .bash-tab {
        background: #1a1a2e !important;
        color: rgba(255,255,255,0.7) !important;
        border-color: #3d3d5c !important;
      }
      .bash-tab:hover {
        background: #3d3d5c !important;
        color: white !important;
      }
      .bash-tab.active {
        background: #f57c00 !important;
        color: white !important;
        border-color: #f57c00 !important;
      }
      
      /* Schedule filters - dark theme */
      .bash-schedule-filters {
        background: transparent !important;
      }
      .bash-filter-btn {
        background: #1a1a2e !important;
        color: rgba(255,255,255,0.7) !important;
        border-color: #3d3d5c !important;
      }
      .bash-filter-btn.active {
        background: #f57c00 !important;
        color: white !important;
      }
      .bash-filter-select {
        background: #1a1a2e !important;
        color: white !important;
        border-color: #3d3d5c !important;
      }
      
      /* Schedule table - dark theme + mobile scroll */
      .bash-schedule-table-wrap {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
      }
      .bash-schedule-tbl {
        min-width: 700px !important;
        table-layout: fixed;
        background: #2d2d44;
      }
      .bash-schedule-tbl th {
        background: #1a1a2e !important;
        color: rgba(255,255,255,0.7) !important;
        padding: 10px 6px !important;
        font-size: 11px !important;
        white-space: nowrap !important;
      }
      .bash-schedule-tbl td {
        padding: 10px 6px !important;
        font-size: 12px !important;
        white-space: nowrap !important;
        border-bottom-color: #3d3d5c !important;
        color: white !important;
      }
      .bash-schedule-tbl .date-row td {
        background: #f57c00 !important;
      }
      .bash-schedule-tbl .game-row:hover {
        background: #3d3d5c !important;
      }
      .bash-schedule-tbl .col-time {
        width: 70px !important;
        color: rgba(255,255,255,0.7) !important;
      }
      .bash-schedule-tbl .col-gender {
        width: 50px !important;
      }
      .bash-schedule-tbl .col-site {
        width: 45px !important;
        color: rgba(255,255,255,0.5) !important;
      }
      .bash-schedule-tbl .col-away,
      .bash-schedule-tbl .col-home {
        width: 150px !important;
      }
      .bash-schedule-tbl .col-score {
        width: 70px !important;
        color: rgba(255,255,255,0.7) !important;
      }
      .bash-schedule-tbl .col-coverage {
        width: 100px !important;
      }
      .team-cell {
        white-space: nowrap !important;
      }
      .team-name-text {
        overflow: hidden;
        text-overflow: ellipsis;
        color: white !important;
      }
      .team-name-text.winner {
        color: #f57c00 !important;
      }
      .team-logo-small {
        width: 20px !important;
        height: 20px !important;
      }
      .coverage-link {
        color: #f57c00 !important;
      }
      
      /* History section - dark theme + mobile scroll */
      .bash-history-tabs {
        flex-wrap: wrap;
      }
      .bash-history-tab {
        background: #1a1a2e !important;
        color: rgba(255,255,255,0.7) !important;
        padding: 8px 16px !important;
        font-size: 13px !important;
      }
      .bash-history-tab.active {
        background: #f57c00 !important;
        color: white !important;
      }
      .bash-history-content {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .bash-history-table {
        min-width: 600px !important;
        background: #2d2d44;
      }
      .bash-history-table th {
        background: #1a1a2e !important;
        color: rgba(255,255,255,0.7) !important;
        padding: 10px 8px !important;
        font-size: 11px !important;
        white-space: nowrap !important;
      }
      .bash-history-table td {
        padding: 10px 8px !important;
        font-size: 12px !important;
        white-space: nowrap !important;
        border-bottom-color: #3d3d5c !important;
        color: white !important;
      }
      .bash-history-table tr:hover {
        background: #3d3d5c !important;
      }
      
      /* Awards section - dark theme */
      .awards-controls {
        flex-direction: column;
        align-items: stretch;
      }
      .awards-view-toggle {
        background: #1a1a2e !important;
      }
      .awards-view-btn {
        background: transparent !important;
        color: rgba(255,255,255,0.7) !important;
      }
      .awards-view-btn.active {
        background: #f57c00 !important;
        color: white !important;
      }
      .awards-year-jump select {
        background: #1a1a2e !important;
        color: white !important;
        border-color: #3d3d5c !important;
      }
      .awards-year-section {
        background: #2d2d44 !important;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 16px;
      }
      .awards-year-title {
        color: #f57c00 !important;
      }
      .awards-gender-card {
        background: #1a1a2e !important;
      }
      .awards-gender-title {
        color: white !important;
      }
      .awards-item {
        border-bottom-color: #3d3d5c !important;
      }
      .awards-item-award {
        color: #f57c00 !important;
      }
      .awards-item-name {
        color: white !important;
      }
      .awards-item-school {
        color: rgba(255,255,255,0.6) !important;
      }
      
      /* Bracket - mobile scroll */
      .bracket-container {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
      }
      .bracket-wrapper {
        min-width: 900px;
        background: transparent !important;
      }
      .bash-bracket-title {
        color: white !important;
      }
      .bash-bracket-subtitle {
        color: rgba(255,255,255,0.7) !important;
      }
      .bracket-headers {
        background: transparent !important;
      }
      .bracket-header {
        background: #1a1a2e !important;
        color: white !important;
      }
      .bracket-game {
        background: #2d2d44 !important;
        border-color: #3d3d5c !important;
      }
      .bracket-game-label {
        background: #1a1a2e !important;
        color: rgba(255,255,255,0.6) !important;
        border-bottom-color: #3d3d5c !important;
      }
      .bracket-matchup {
        background: #2d2d44 !important;
      }
      .bracket-team {
        background: #2d2d44 !important;
        border-bottom-color: #3d3d5c !important;
      }
      .bracket-team:hover {
        background: #3d3d5c !important;
      }
      .bracket-team-name {
        color: white !important;
      }
      .bracket-team-score {
        color: white !important;
      }
      .bracket-team.pending {
        opacity: 0.5;
      }
      .bracket-team.bye-team,
      .bracket-team.advancing {
        background: #3d3d5c !important;
        border-left-color: #f57c00 !important;
      }
      .bracket-team.bye-team .bracket-team-name,
      .bracket-team.advancing .bracket-team-name {
        color: #f57c00 !important;
      }
      
      /* Today's games cards - ensure dark theme */
      .bash-today-game {
        background: #2d2d44 !important;
      }
      .bash-today-team .team-name {
        color: white !important;
      }
      .bash-today-team .team-score {
        color: white !important;
      }
      .bash-today-team {
        border-bottom-color: #3d3d5c !important;
      }
      .bash-today-meta {
        color: rgba(255,255,255,0.6) !important;
      }
      .bash-today-info {
        color: rgba(255,255,255,0.7) !important;
      }
    }
    
    /* Bracket winner/loser styling */
    .bracket-team.winner {
      background: linear-gradient(135deg, #f57c00 0%, #e65100 100%) !important;
    }
    .bracket-team.winner .bracket-team-name {
      font-weight: 700;
    }
    .bracket-team.winner .bracket-team-score {
      font-weight: 700;
      color: #fff;
    }
    .bracket-team.loser {
      opacity: 0.6;
    }
    .bracket-team-score {
      margin-left: auto;
      font-size: 14px;
      font-weight: 600;
      min-width: 24px;
      text-align: right;
    }
    
    /* Awards view styles */
    .awards-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .awards-view-toggle {
      display: flex;
      gap: 8px;
      background: #f5f5f5;
      padding: 4px;
      border-radius: 8px;
    }
    .awards-view-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      color: #666;
      transition: all 0.2s;
    }
    .awards-view-btn:hover {
      background: #e0e0e0;
    }
    .awards-view-btn.active {
      background: #f57c00;
      color: white;
    }
    .awards-year-jump {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }
    .awards-year-jump label {
      font-size: 13px;
      color: #666;
    }
    .awards-year-jump select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }
    .awards-year-jump select:focus {
      outline: none;
      border-color: #f57c00;
    }
    .awards-year-section {
      margin-bottom: 24px;
      scroll-margin-top: 20px;
    }
    .awards-year-title {
      font-size: 20px;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 3px solid #f57c00;
    }
    .awards-year-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    @media (max-width: 1200px) {
      .awards-year-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 600px) {
      .awards-year-grid {
        grid-template-columns: 1fr;
      }
    }
    .awards-gender-card {
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .awards-gender-card.boys {
      border-top: 3px solid #1a1a2e;
    }
    .awards-gender-card.girls {
      border-top: 3px solid #f57c00;
    }
    .awards-gender-title {
      font-size: 13px;
      font-weight: 600;
      color: #333;
      margin: 0 0 10px 0;
    }
    .awards-item {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .awards-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    .awards-item-award {
      display: block;
      font-size: 10px;
      font-weight: 600;
      color: #f57c00;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }
    .awards-item-recipient {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .awards-item-logo {
      width: 28px;
      height: 28px;
      object-fit: contain;
    }
    .awards-item-info {
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .awards-item-name {
      font-size: 12px;
      font-weight: 600;
      color: #1a1a2e;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .awards-item-school {
      font-size: 11px;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .awards-empty {
      color: #999;
      font-size: 12px;
      font-style: italic;
    }
    .awards-search-box {
      margin-bottom: 16px;
    }
    .awards-search-box input {
      width: 100%;
      max-width: 300px;
      padding: 10px 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }
    .awards-search-box input:focus {
      outline: none;
      border-color: #f57c00;
    }
    .sortable-table th.sortable {
      cursor: pointer;
      user-select: none;
    }
    .sortable-table th.sortable:hover {
      background: #f5f5f5;
    }
  </style>
  
  <!-- Open Graph -->
  <meta property="og:title" content="The Bash 2025 | Ball603">
  <meta property="og:description" content="New Hampshire's Largest Holiday Basketball Tournament - 28 teams, 50 games, December 26-30">
  <meta property="og:image" content="https://ball603.com/logos/TheBash.png">
  <meta property="og:url" content="https://ball603.com/the-bash">
</head>
<body class="bash-landing">
  <!-- Navigation (loaded dynamically) -->
  <div id="site-header"></div>
  <div id="mobile-menu"></div>
  <script src="/includes/nav-loader.js"></script>

  <!-- Continue to Main Site Banner -->
  <div class="bash-continue-banner" id="continueBanner">
    <span>You're viewing The Bash tournament site</span>
    <a href="/" class="bash-continue-btn" onclick="dismissBashBanner()">Continue to Ball603.com &rarr;</a>
  </div>
  
  <!-- Header -->
  <header class="bash-landing-header">
    <div class="bash-landing-header-inner">
      <a href="/the-bash" class="bash-landing-logo">
        <img src="/logos/TheBash.png" alt="The Bash" style="height: 40px;">
      </a>
      <nav class="bash-landing-nav">
        <a href="#schedule" class="bash-nav-link">Schedule</a>
        <a href="#brackets" class="bash-nav-link">Brackets</a>
        <a href="#stories" class="bash-nav-link">Stories</a>
        <a href="#history" class="bash-nav-link">History</a>
      </nav>
      <a href="/" class="bash-main-site-link">Ball603.com</a>
    </div>
  </header>

  <!-- Hero Section with Snow -->
  <section class="bash-hero" id="bashHero">
    <div class="snow-container" id="snowContainer"></div>
    <div class="bash-hero-content">
      <div class="bash-hero-tagline">New Hampshire's Largest Holiday Tournament</div>
      <img src="/logos/TheBash.png" alt="The Bash" class="bash-hero-logo">
      <div class="bash-hero-dates">December 26-30, 2025</div>
      <div class="bash-hero-venue">Farmington High School</div>
      <div class="bash-hero-stats">
        <div class="bash-hero-stat">
          <span class="stat-value">28</span>
          <span class="stat-label">Teams</span>
        </div>
        <div class="bash-hero-stat">
          <span class="stat-value">50</span>
          <span class="stat-label">Games</span>
        </div>
        <div class="bash-hero-stat">
          <span class="stat-value">45+</span>
          <span class="stat-label">Years</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Recap (if exists) -->
  <section class="bash-featured" id="bashFeatured" style="display: none;">
    <div class="bash-featured-inner">
      <div class="bash-featured-card" id="featuredRecap">
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="bash-landing-main">
    <!-- Today's Games -->
    <section class="bash-today" id="bashToday">
      <div class="bash-section-header">
        <h2 class="bash-section-title" id="todayTitle">Today's Games</h2>
        <a href="#schedule" class="bash-section-link">Full Schedule &rarr;</a>
      </div>
      <div class="bash-today-scroll" id="todayGames">
        <div class="bash-loading">Loading games...</div>
      </div>
    </section>

    <!-- Quick Nav Pills -->
    <section class="bash-quicklinks">
      <div class="bash-quicklinks-inner">
        <a href="#schedule" class="bash-pill" data-tab="schedule">
          <span>&#128197;</span> Schedule & Results
        </a>
        <a href="#boys-bracket" class="bash-pill" data-tab="boys-bracket">
          <span>&#127936;</span> Boys Bracket
        </a>
        <a href="#girls-bracket" class="bash-pill" data-tab="girls-bracket">
          <span>&#127936;</span> Girls Bracket
        </a>
        <a href="#history" class="bash-pill" data-tab="history">
          <span>&#127942;</span> History & Records
        </a>
      </div>
    </section>

    <!-- Stories Feed -->
    <section class="bash-stories" id="stories">
      <div class="bash-section-header">
        <h2 class="bash-section-title">Latest Stories</h2>
      </div>
      <div class="bash-stories-grid" id="bashStoriesGrid">
        <div class="bash-loading">Loading stories...</div>
      </div>
    </section>

    <!-- Tab Content Area -->
    <section class="bash-tabs-section" id="brackets">
      <!-- Tab Navigation -->
      <div class="bash-tabs" id="schedule">
        <button class="bash-tab active" data-tab="schedule">Schedule</button>
        <button class="bash-tab" data-tab="boys-bracket" id="boys-bracket">Boys Bracket</button>
        <button class="bash-tab" data-tab="girls-bracket" id="girls-bracket">Girls Bracket</button>
        <button class="bash-tab" data-tab="history" id="history">History</button>
      </div>

      <!-- Schedule Panel -->
      <div class="bash-panel active" id="schedulePanel">
        <div class="bash-schedule-filters">
          <button class="bash-filter-btn active" data-filter="all">ALL GAMES</button>
          <select class="bash-filter-select" id="divisionFilter">
            <option value="">Division</option>
            <option value="Boys">Boys</option>
            <option value="Girls">Girls</option>
          </select>
          <select class="bash-filter-select" id="dayFilter">
            <option value="">Day</option>
            <option value="Dec 26">Dec 26</option>
            <option value="Dec 27">Dec 27</option>
            <option value="Dec 28">Dec 28</option>
            <option value="Dec 29">Dec 29</option>
            <option value="Dec 30">Dec 30</option>
          </select>
        </div>
        <div class="bash-schedule-table-wrap" id="scheduleTable">
          <div class="bash-loading">Loading schedule...</div>
        </div>
      </div>

      <!-- Boys Bracket Panel -->
      <div class="bash-panel" id="boys-bracketPanel">
        <h3 class="bash-bracket-title">Boys Championship Bracket</h3>
        <div class="bracket-container" id="boysBracket">
          <!-- March Madness Style Bracket -->
          <div class="bracket-wrapper">
            <!-- Round Headers -->
            <div class="bracket-headers">
              <div class="bracket-header">First Round</div>
              <div class="bracket-header">Quarterfinals</div>
              <div class="bracket-header">Semifinals</div>
              <div class="bracket-header">Championship</div>
            </div>
            
            <div class="bracket-rounds">
              <!-- First Round - 8 Games -->
              <div class="bracket-round round-1">
                <!-- Game 1 -->
                <div class="bracket-game" data-game="1">
                  <div class="bracket-game-label">Game 1 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="1">
                      <img class="bracket-team-logo" src="/logos/100px/Nute.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Nute</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="16">
                      <img class="bracket-team-logo" src="/logos/100px/Raymond.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Raymond</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 2 -->
                <div class="bracket-game" data-game="2">
                  <div class="bracket-game-label">Game 2 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="8">
                      <img class="bracket-team-logo" src="/logos/100px/Belmont.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Belmont</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="9">
                      <img class="bracket-team-logo" src="/logos/100px/Kennett.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Kennett</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 3 -->
                <div class="bracket-game" data-game="3">
                  <div class="bracket-game-label">Game 3 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="4">
                      <img class="bracket-team-logo" src="/logos/100px/Franklin.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Franklin</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="13">
                      <img class="bracket-team-logo" src="/logos/100px/Derryfield.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Derryfield</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 4 -->
                <div class="bracket-game" data-game="4">
                  <div class="bracket-game-label">Game 4 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="5">
                      <img class="bracket-team-logo" src="/logos/100px/InterLakes.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Inter-Lakes</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="12">
                      <img class="bracket-team-logo" src="/logos/100px/ConcordChristian.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Concord Christian</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 5 -->
                <div class="bracket-game" data-game="5">
                  <div class="bracket-game-label">Game 5 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="2">
                      <img class="bracket-team-logo" src="/logos/100px/PortsmouthChristian.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Portsmouth Christian</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="15">
                      <img class="bracket-team-logo" src="/logos/100px/ProspectMountain.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Prospect Mountain</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 6 -->
                <div class="bracket-game" data-game="6">
                  <div class="bracket-game-label">Game 6 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="7">
                      <img class="bracket-team-logo" src="/logos/100px/CoeBrown.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Coe-Brown</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="10">
                      <img class="bracket-team-logo" src="/logos/100px/HolyFamily.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Holy Family</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 7 -->
                <div class="bracket-game" data-game="7">
                  <div class="bracket-game-label">Game 7 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="3">
                      <img class="bracket-team-logo" src="/logos/100px/Kingswood.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Kingswood</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="14">
                      <img class="bracket-team-logo" src="/logos/100px/Epping.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Epping</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 8 -->
                <div class="bracket-game" data-game="8">
                  <div class="bracket-game-label">Game 8 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top" data-seed="6">
                      <img class="bracket-team-logo" src="/logos/100px/Profile.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Profile</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom" data-seed="11">
                      <img class="bracket-team-logo" src="/logos/100px/Farmington.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Farmington</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Quarterfinals - 4 Games -->
              <div class="bracket-round round-2">
                <!-- Game 9 -->
                <div class="bracket-game" data-game="9">
                  <div class="bracket-game-label">Game 9 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 1</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 2</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 10 -->
                <div class="bracket-game" data-game="10">
                  <div class="bracket-game-label">Game 10 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 3</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 4</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 11 -->
                <div class="bracket-game" data-game="11">
                  <div class="bracket-game-label">Game 11 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 5</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 6</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 12 -->
                <div class="bracket-game" data-game="12">
                  <div class="bracket-game-label">Game 12 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 7</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 8</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Semifinals - 2 Games -->
              <div class="bracket-round round-3">
                <!-- Game 13 -->
                <div class="bracket-game" data-game="13">
                  <div class="bracket-game-label">Game 13 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 9</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 10</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 14 -->
                <div class="bracket-game" data-game="14">
                  <div class="bracket-game-label">Game 14 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 11</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 12</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Championship -->
              <div class="bracket-round round-4">
                <!-- Game 15 -->
                <div class="bracket-game championship" data-game="15">
                  <div class="bracket-game-label">Game 15 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 13</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 14</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Girls Bracket Panel -->
      <div class="bash-panel" id="girls-bracketPanel">
        <h3 class="bash-bracket-title">Girls Championship Bracket</h3>
        <p class="bash-bracket-subtitle">12 Teams - 4 First Round Byes</p>
        <div class="bracket-container" id="girlsBracket">
          <div class="bracket-wrapper girls-bracket-wrapper">
            <!-- Round Headers -->
            <div class="bracket-headers girls-headers">
              <div class="bracket-header">First Round</div>
              <div class="bracket-header">Quarterfinals</div>
              <div class="bracket-header">Semifinals</div>
              <div class="bracket-header">Championship</div>
            </div>
            
            <div class="bracket-rounds girls-rounds">
              <!-- First Round - 4 Games -->
              <div class="bracket-round girls-round-1">
                <!-- Game 1 -->
                <div class="bracket-game" data-game="1">
                  <div class="bracket-game-label">Game 1 - HWMS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top">
                      <img class="bracket-team-logo" src="/logos/100px/Nute.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Nute</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom">
                      <img class="bracket-team-logo" src="/logos/100px/Belmont.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Belmont</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 2 -->
                <div class="bracket-game" data-game="2">
                  <div class="bracket-game-label">Game 2 - HWMS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top">
                      <img class="bracket-team-logo" src="/logos/100px/Raymond.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Raymond</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom">
                      <img class="bracket-team-logo" src="/logos/100px/Souhegan.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Souhegan</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 3 -->
                <div class="bracket-game" data-game="3">
                  <div class="bracket-game-label">Game 3 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top">
                      <img class="bracket-team-logo" src="/logos/100px/Kingswood.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Kingswood</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom">
                      <img class="bracket-team-logo" src="/logos/100px/ProspectMountain.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Prospect Mountain</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 4 -->
                <div class="bracket-game" data-game="4">
                  <div class="bracket-game-label">Game 4 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top">
                      <img class="bracket-team-logo" src="/logos/100px/Kennett.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Kennett</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom">
                      <img class="bracket-team-logo" src="/logos/100px/Epping.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Epping</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Quarterfinals - 4 Games (Bye teams enter) -->
              <div class="bracket-round girls-round-2">
                <!-- Game 5 -->
                <div class="bracket-game" data-game="5">
                  <div class="bracket-game-label">Game 5 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 1</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom bye-team">
                      <img class="bracket-team-logo" src="/logos/100px/Franklin.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Franklin</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 6 -->
                <div class="bracket-game" data-game="6">
                  <div class="bracket-game-label">Game 6 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 2</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom bye-team">
                      <img class="bracket-team-logo" src="/logos/100px/CoeBrown.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Coe-Brown</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 7 -->
                <div class="bracket-game" data-game="7">
                  <div class="bracket-game-label">Game 7 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 3</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom bye-team">
                      <img class="bracket-team-logo" src="/logos/100px/PortsmouthChristian.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Portsmouth Christian</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 8 -->
                <div class="bracket-game" data-game="8">
                  <div class="bracket-game-label">Game 8 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 4</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom bye-team">
                      <img class="bracket-team-logo" src="/logos/100px/Farmington.png" onerror="this.src='/logos/100px/Ball603-white.png'">
                      <span class="bracket-team-name">Farmington</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Semifinals - 2 Games -->
              <div class="bracket-round girls-round-3">
                <!-- Game 9 -->
                <div class="bracket-game" data-game="9">
                  <div class="bracket-game-label">Game 9 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 5</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 6</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
                
                <!-- Game 10 -->
                <div class="bracket-game" data-game="10">
                  <div class="bracket-game-label">Game 10 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 7</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 8</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Championship -->
              <div class="bracket-round girls-round-4">
                <!-- Game 11 -->
                <div class="bracket-game championship" data-game="11">
                  <div class="bracket-game-label">Game 11 - FHS</div>
                  <div class="bracket-matchup">
                    <div class="bracket-team top pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 9</span>
                      <span class="bracket-team-score"></span>
                    </div>
                    <div class="bracket-team bottom pending">
                      <img class="bracket-team-logo" src="/logos/100px/Ball603-white.png">
                      <span class="bracket-team-name">Winner 10</span>
                      <span class="bracket-team-score"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- History Panel -->
      <div class="bash-panel" id="historyPanel">
        <div class="bash-history-tabs">
          <button class="bash-history-tab active" data-history="champions">Champions</button>
          <button class="bash-history-tab" data-history="awards">Awards</button>
        </div>
        <div class="bash-history-content" id="historyContent">
          <div class="bash-loading">Loading history...</div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bash-footer">
    <div class="bash-footer-inner">
      <div class="bash-footer-brand">
        <img src="/logos/TheBash.png" alt="The Bash" style="height: 50px; margin-bottom: 10px;">
        <p>New Hampshire's Largest Holiday Tournament</p>
        <p style="font-size: 12px; opacity: 0.7;">Est. 1979 - Farmington, NH</p>
      </div>
      <div class="bash-footer-links">
        <a href="/">Ball603.com</a>
        <a href="/schedule">NH Schedule</a>
        <a href="/standings">Standings</a>
      </div>
      <div class="bash-footer-powered">
        <span>Powered by</span>
        <a href="/">
          <img src="/logo.png" alt="Ball603" style="height: 30px; vertical-align: middle;">
        </a>
      </div>
    </div>
  </footer>

  <!-- Tournament Data -->
  <script src="/the-bash-data.js"></script>

  <script>
    // Supabase client for loading data
    const SUPABASE_URL = 'https://suncdkxfqkwwnmhosxcf.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_hHSpgZPD327r11GaQG9iHw_uZbuaWmF';
    const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // Dynamic schedule data from database
    let liveSchedule = [];
    
    // Load schedule from database
    async function loadLiveSchedule() {
      try {
        const { data, error } = await db
          .from('bash_schedule')
          .select('*')
          .eq('year', 2025)
          .order('date')
          .order('time');
        
        if (error) throw error;
        
        liveSchedule = (data || []).map(g => ({
          ...g,
          awayScore: g.away_score,
          homeScore: g.home_score
        }));
        
        console.log('Loaded', liveSchedule.length, 'games from database');
        return liveSchedule;
      } catch (err) {
        console.error('Error loading schedule:', err);
        // Fall back to static data
        liveSchedule = BASH_DATA?.schedule || [];
        return liveSchedule;
      }
    }
    
    // Get winner of a specific game by game number and division
    function getGameWinner(gameNumber, division) {
      const game = liveSchedule.find(g => 
        g.game_number === gameNumber && 
        g.division === division &&
        g.away_score !== null && 
        g.home_score !== null
      );
      
      if (!game) return null;
      
      return {
        team: game.away_score > game.home_score ? game.away : game.home,
        awayScore: game.away_score,
        homeScore: game.home_score,
        away: game.away,
        home: game.home
      };
    }
    
    // Boys bracket advancement mapping
    const BOYS_ADVANCEMENT = {
      // Quarterfinals (Games 9-12) receive winners from First Round (Games 1-8)
      9: { top: 1, bottom: 2 },
      10: { top: 3, bottom: 4 },
      11: { top: 5, bottom: 6 },
      12: { top: 7, bottom: 8 },
      // Semifinals (Games 13-14) receive winners from Quarterfinals
      13: { top: 9, bottom: 10 },
      14: { top: 11, bottom: 12 },
      // Championship (Game 15) receives winners from Semifinals
      15: { top: 13, bottom: 14 }
    };
    
    // Girls bracket advancement mapping (12 teams, 4 byes)
    const GIRLS_ADVANCEMENT = {
      // Quarterfinals (Games 5-8) - Winner from first round vs Bye team
      5: { top: 1, bottom: null }, // Winner 1 vs Franklin (bye - already in HTML)
      6: { top: 2, bottom: null }, // Winner 2 vs Coe-Brown (bye)
      7: { top: 3, bottom: null }, // Winner 3 vs Portsmouth Christian (bye)
      8: { top: 4, bottom: null }, // Winner 4 vs Farmington (bye)
      // Semifinals (Games 9-10) receive winners from Quarterfinals
      9: { top: 5, bottom: 6 },
      10: { top: 7, bottom: 8 },
      // Championship (Game 11) receives winners from Semifinals
      11: { top: 9, bottom: 10 }
    };
    
    // Update bracket with scores and advancement
    function updateBrackets() {
      updateBracket('boysBracket', 'Boys', BOYS_ADVANCEMENT);
      updateBracket('girlsBracket', 'Girls', GIRLS_ADVANCEMENT);
    }
    
    function updateBracket(bracketId, division, advancementMap) {
      const bracket = document.getElementById(bracketId);
      if (!bracket) return;
      
      // First, update scores for all completed games
      bracket.querySelectorAll('.bracket-game').forEach(gameEl => {
        const gameNum = parseInt(gameEl.dataset.game);
        const game = liveSchedule.find(g => 
          g.game_number === gameNum && 
          g.division === division
        );
        
        if (game && game.away_score !== null && game.home_score !== null) {
          const topTeam = gameEl.querySelector('.bracket-team.top');
          const bottomTeam = gameEl.querySelector('.bracket-team.bottom');
          
          if (topTeam && bottomTeam) {
            const topScore = topTeam.querySelector('.bracket-team-score');
            const bottomScore = bottomTeam.querySelector('.bracket-team-score');
            
            // Set scores
            if (topScore) topScore.textContent = game.away_score;
            if (bottomScore) bottomScore.textContent = game.home_score;
            
            // Highlight winner
            topTeam.classList.remove('winner', 'loser');
            bottomTeam.classList.remove('winner', 'loser');
            
            if (game.away_score > game.home_score) {
              topTeam.classList.add('winner');
              bottomTeam.classList.add('loser');
            } else {
              bottomTeam.classList.add('winner');
              topTeam.classList.add('loser');
            }
          }
        }
      });
      
      // Then, advance winners to next rounds
      Object.keys(advancementMap).forEach(targetGame => {
        const sources = advancementMap[targetGame];
        const targetGameEl = bracket.querySelector(`.bracket-game[data-game="${targetGame}"]`);
        if (!targetGameEl) return;
        
        const topTeamEl = targetGameEl.querySelector('.bracket-team.top');
        const bottomTeamEl = targetGameEl.querySelector('.bracket-team.bottom');
        
        // Advance top team (winner from sources.top)
        if (sources.top && topTeamEl) {
          const winner = getGameWinner(sources.top, division);
          if (winner) {
            updateTeamSlot(topTeamEl, winner.team);
          }
        }
        
        // Advance bottom team (winner from sources.bottom)
        if (sources.bottom && bottomTeamEl) {
          const winner = getGameWinner(sources.bottom, division);
          if (winner) {
            updateTeamSlot(bottomTeamEl, winner.team);
          }
        }
      });
    }
    
    function updateTeamSlot(teamEl, teamName) {
      if (!teamEl || !teamName) return;
      
      const nameSpan = teamEl.querySelector('.bracket-team-name');
      const logoImg = teamEl.querySelector('.bracket-team-logo');
      
      if (nameSpan) {
        nameSpan.textContent = teamName;
      }
      if (logoImg) {
        logoImg.src = getTeamLogo(teamName);
        logoImg.onerror = function() { this.src = '/logos/100px/Ball603-white.png'; };
      }
      
      // Remove pending class since team is now known
      teamEl.classList.remove('pending');
    }
    
    // Load Bash stories from articles table
    async function loadBashStories() {
      const container = document.getElementById('bashStoriesGrid');
      if (!container) return;
      
      try {
        // Fetch articles tagged with 'The Bash' that are published
        const { data: articles, error } = await db
          .from('articles')
          .select('*')
          .contains('tags', ['The Bash'])
          .eq('status', 'published')
          .order('published_at', { ascending: false })
          .limit(12);
        
        if (error) throw error;
        
        if (!articles || articles.length === 0) {
          container.innerHTML = '<div class="bash-no-stories">Stories coming soon! Check back during the tournament.</div>';
          return;
        }
        
        container.innerHTML = articles.map(article => {
          const date = article.published_at ? new Date(article.published_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : '';
          const excerpt = article.excerpt || (article.content ? article.content.replace(/<[^>]*>/g, '').substring(0, 120) + '...' : '');
          const thumbnail = article.featured_image_url || article.thumbnail_url || '/logos/100px/Ball603-white.png';
          
          return `
            <a href="/article/${article.slug}" class="bash-story-card">
              <div class="bash-story-image" style="background-image: url('${thumbnail}')"></div>
              <div class="bash-story-content">
                <span class="bash-story-date">${date}</span>
                <h3 class="bash-story-title">${article.title}</h3>
                <p class="bash-story-excerpt">${excerpt}</p>
              </div>
            </a>
          `;
        }).join('');
        
      } catch (err) {
        console.error('Error loading stories:', err);
        container.innerHTML = '<div class="bash-no-stories">Unable to load stories. Please try again later.</div>';
      }
    }

    // Teams lookup from API
    let teamsLookup = {};
    
    // Tournament days
    const TOURNAMENT_DAYS = [
      { day: 1, date: 'December 26', dateKey: 'Dec 26' },
      { day: 2, date: 'December 27', dateKey: 'Dec 27' },
      { day: 3, date: 'December 28', dateKey: 'Dec 28' },
      { day: 4, date: 'December 29', dateKey: 'Dec 29' },
      { day: 5, date: 'December 30', dateKey: 'Dec 30' }
    ];
    
    // Load teams from API
    async function loadTeamsLookup() {
      try {
        const response = await fetch('/.netlify/functions/teams');
        const data = await response.json();
        if (data.success && data.teams) {
          data.teams.forEach(team => {
            const shortname = (team.shortname || '').toLowerCase().trim();
            if (shortname) {
              teamsLookup[shortname] = team;
              teamsLookup[shortname.replace(/\s+/g, '-')] = team;
              teamsLookup[shortname.replace(/\s+/g, '')] = team;
              teamsLookup[shortname.replace(/-/g, ' ')] = team;
            }
          });
        }
      } catch (e) {
        console.log('Teams lookup:', e);
      }
    }
    
    // Team logo helper - checks API then falls back to path
    function getTeamLogo(teamName) {
      if (!teamName || teamName.includes('Winner') || teamName.includes('Loser') || teamName === 'TBD') {
        return '/logos/100px/Ball603-white.png';
      }
      
      const variations = [
        teamName.toLowerCase().trim(),
        teamName.toLowerCase().trim().replace(/\s+/g, '-'),
        teamName.toLowerCase().trim().replace(/\s+/g, ''),
        teamName.toLowerCase().trim().replace(/-/g, ' ')
      ];
      
      for (const key of variations) {
        const team = teamsLookup[key];
        if (team && team.logo_url) {
          return team.logo_url;
        }
      }
      
      const logoName = teamName.replace(/[^a-zA-Z0-9]/g, '');
      return `/logos/100px/${logoName}.png`;
    }
    
    // Get current tournament day
    function getCurrentTournamentDay() {
      const today = new Date();
      const month = today.getMonth();
      const day = today.getDate();
      
      if (month === 11 && day >= 26 && day <= 30) {
        return day - 25;
      }
      return 1;
    }

    // Snow effect
    function createSnow() {
      const container = document.getElementById('snowContainer');
      if (!container) return;
      
      const snowflakes = ['', '', '', '*'];
      
      for (let i = 0; i < 60; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 4 + 5) + 's';
        snowflake.style.animationDelay = Math.random() * 10 + 's';
        snowflake.style.fontSize = (Math.random() * 14 + 12) + 'px';
        snowflake.style.opacity = Math.random() * 0.5 + 0.5;
        container.appendChild(snowflake);
      }
    }

    // Banner dismiss
    function dismissBashBanner() {
      document.getElementById('continueBanner').style.display = 'none';
      localStorage.setItem('bashBannerDismissed', 'true');
    }
    
    // Initialize day games
    function initDayGames() {
      const currentDay = getCurrentTournamentDay();
      const dayInfo = TOURNAMENT_DAYS[currentDay - 1];
      
      document.getElementById('todayTitle').textContent = `Day ${dayInfo.day}: ${dayInfo.date}`;
      
      // Use liveSchedule from database, fall back to BASH_DATA
      const allGames = liveSchedule.length > 0 ? liveSchedule : (BASH_DATA?.schedule || []);
      const games = allGames.filter(g => g.date && g.date.includes(dayInfo.dateKey));
      renderDayGames(games);
    }

    // Render day games
    function renderDayGames(games) {
      const container = document.getElementById('todayGames');

      if (games.length === 0) {
        container.innerHTML = '<div class="bash-no-games">No games scheduled</div>';
        return;
      }

      container.innerHTML = games.map(g => {
        const hasScore = g.awayScore !== null && g.homeScore !== null;
        return `
          <div class="bash-today-game">
            <div class="bash-today-time">${g.time}</div>
            <div class="bash-today-teams">
              <div class="bash-today-team ${hasScore && g.awayScore > g.homeScore ? 'winner' : ''}">
                <div class="bash-today-team-info">
                  <img class="bash-today-logo" src="${getTeamLogo(g.away)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                  <span class="team-name">${g.away}</span>
                </div>
                ${hasScore ? `<span class="team-score">${g.awayScore}</span>` : ''}
              </div>
              <div class="bash-today-team ${hasScore && g.homeScore > g.awayScore ? 'winner' : ''}">
                <div class="bash-today-team-info">
                  <img class="bash-today-logo" src="${getTeamLogo(g.home)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                  <span class="team-name">${g.home}</span>
                </div>
                ${hasScore ? `<span class="team-score">${g.homeScore}</span>` : ''}
              </div>
            </div>
            <div class="bash-today-meta">
              <span class="bash-today-div">${g.division || ''}</span>
              <span class="bash-today-site">${g.site || ''}</span>
            </div>
            ${g.recap ? `<a href="${g.recap}" class="bash-today-recap">Recap</a>` : ''}
          </div>
        `;
      }).join('');
    }
    
    // Update bracket logos after teams load
    function updateBracketLogos() {
      document.querySelectorAll('.bracket-team-logo').forEach(img => {
        const teamName = img.nextElementSibling?.textContent;
        if (teamName) {
          const newSrc = getTeamLogo(teamName);
          if (newSrc !== img.src) {
            img.src = newSrc;
          }
        }
      });
    }

    // Tab functionality
    function initTabs() {
      document.querySelectorAll('.bash-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;
          
          document.querySelectorAll('.bash-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.bash-panel').forEach(p => p.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(tabName + 'Panel').classList.add('active');
        });
      });

      // Quick links (pills)
      document.querySelectorAll('.bash-pill').forEach(link => {
        link.addEventListener('click', (e) => {
          const tabName = link.dataset.tab;
          document.querySelector(`.bash-tab[data-tab="${tabName}"]`)?.click();
        });
      });
    }

    // Schedule initialization with new column layout
    function initSchedule() {
      renderSchedule();

      document.getElementById('divisionFilter').addEventListener('change', renderSchedule);
      document.getElementById('dayFilter').addEventListener('change', renderSchedule);
      document.querySelector('.bash-filter-btn[data-filter="all"]').addEventListener('click', () => {
        document.getElementById('divisionFilter').value = '';
        document.getElementById('dayFilter').value = '';
        renderSchedule();
      });
    }

    function renderSchedule() {
      const divFilter = document.getElementById('divisionFilter').value;
      const dayFilter = document.getElementById('dayFilter').value;

      // Use liveSchedule from database, fall back to BASH_DATA
      let allGames = liveSchedule.length > 0 ? liveSchedule : (BASH_DATA?.schedule || []);
      let games = allGames.filter(g => !g.special);
      if (divFilter) games = games.filter(g => g.division === divFilter);
      if (dayFilter) games = games.filter(g => g.date === dayFilter);

      const container = document.getElementById('scheduleTable');
      
      if (games.length === 0) {
        container.innerHTML = '<div class="bash-no-games">No games match filters</div>';
        return;
      }

      // Group by date
      const byDate = {};
      games.forEach(g => {
        if (!byDate[g.date]) byDate[g.date] = [];
        byDate[g.date].push(g);
      });

      let html = `
        <table class="bash-schedule-tbl">
          <thead>
            <tr>
              <th class="col-time">Time</th>
              <th class="col-gender">Gender</th>
              <th class="col-site">Site</th>
              <th class="col-away">Away</th>
              <th class="col-score">Score</th>
              <th class="col-home">Home</th>
              <th class="col-coverage">Coverage</th>
            </tr>
          </thead>
          <tbody>
      `;

      Object.keys(byDate).forEach(date => {
        html += `<tr class="date-row"><td colspan="7">${date}</td></tr>`;
        byDate[date].forEach(g => {
          const hasScore = g.awayScore !== null && g.homeScore !== null;
          const awayWinner = hasScore && g.awayScore > g.homeScore;
          const homeWinner = hasScore && g.homeScore > g.awayScore;
          
          html += `
            <tr class="game-row">
              <td class="col-time">${g.time}</td>
              <td class="col-gender">${g.division}</td>
              <td class="col-site">${g.site}</td>
              <td class="col-away">
                <div class="team-cell away">
                  <span class="team-name-text ${awayWinner ? 'winner' : ''}">${g.away}</span>
                  <img class="team-logo-small" src="${getTeamLogo(g.away)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                </div>
              </td>
              <td class="col-score">${hasScore ? `${g.awayScore} - ${g.homeScore}` : 'vs'}</td>
              <td class="col-home">
                <div class="team-cell home">
                  <img class="team-logo-small" src="${getTeamLogo(g.home)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                  <span class="team-name-text ${homeWinner ? 'winner' : ''}">${g.home}</span>
                </div>
              </td>
              <td class="col-coverage">
                ${g.recap ? `<a href="${g.recap}" class="coverage-link">Recap</a>` : ''}
                ${g.photos ? `<a href="${g.photos}" class="coverage-link">Photos</a>` : ''}
              </td>
            </tr>
          `;
        });
      });

      html += '</tbody></table>';
      container.innerHTML = html;
    }

    // History
    let awardsViewMode = 'capsules'; // 'capsules' or 'list'
    let awardsSortColumn = 'year';
    let awardsSortDir = 'desc';
    let awardsSearchTerm = '';
    
    function initHistory() {
      if (typeof BASH_DATA === 'undefined') return;

      document.querySelectorAll('.bash-history-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.bash-history-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          renderHistory(tab.dataset.history);
        });
      });

      renderHistory('champions');
    }

    function renderHistory(type) {
      const container = document.getElementById('historyContent');
      
      if (type === 'champions') {
        const champs = BASH_DATA.champions || [];
        container.innerHTML = `
          <table class="bash-history-table">
            <thead>
              <tr>
                <th>Year</th>
                <th>Division</th>
                <th>Champion</th>
                <th>Score</th>
                <th>Runner-Up</th>
              </tr>
            </thead>
            <tbody>
              ${champs.map(c => `
                <tr>
                  <td>${c.year}</td>
                  <td>${c.gender}</td>
                  <td>
                    <div class="team-cell">
                      <img class="team-logo-small" src="${getTeamLogo(c.champion)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                      <span class="team-name-text">${c.champion}</span>
                    </div>
                  </td>
                  <td>${c.championScore}-${c.runnerUpScore}${c.overtime ? ' OT' : ''}</td>
                  <td>
                    <div class="team-cell">
                      <img class="team-logo-small" src="${getTeamLogo(c.runnerUp)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                      <span class="team-name-text">${c.runnerUp}</span>
                    </div>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } else {
        renderAwards();
      }
    }
    
    function renderAwards() {
      const container = document.getElementById('historyContent');
      const awards = BASH_DATA.awards || [];
      
      // Award order priority
      const awardOrder = ['MVP', 'All-Tourney Team', 'Team Sportsmanship', 'Sportsmanship', '3-Point', 'Skills', 'Dunk'];
      
      function sortAwardsByOrder(awardsList) {
        return awardsList.sort((a, b) => {
          const aIdx = awardOrder.findIndex(o => a.award && a.award.toLowerCase().includes(o.toLowerCase()));
          const bIdx = awardOrder.findIndex(o => b.award && b.award.toLowerCase().includes(o.toLowerCase()));
          const aOrder = aIdx === -1 ? 999 : aIdx;
          const bOrder = bIdx === -1 ? 999 : bIdx;
          return aOrder - bOrder;
        });
      }
      
      // Get unique years
      const years = [...new Set(awards.map(a => a.year))].sort((a, b) => b - a);
      
      // View toggle buttons
      const viewToggle = `
        <div class="awards-controls">
          <div class="awards-view-toggle">
            <button class="awards-view-btn ${awardsViewMode === 'capsules' ? 'active' : ''}" onclick="setAwardsView('capsules')">
              <span></span> Year View
            </button>
            <button class="awards-view-btn ${awardsViewMode === 'list' ? 'active' : ''}" onclick="setAwardsView('list')">
              <span></span> List View
            </button>
          </div>
        </div>
      `;
      
      if (awardsViewMode === 'capsules') {
        // Year jump dropdown
        const yearDropdown = `
          <div class="awards-year-jump">
            <label>Jump to year:</label>
            <select onchange="scrollToAwardsYear(this.value)">
              <option value="">Select year...</option>
              ${years.map(y => `<option value="${y}">${y}</option>`).join('')}
            </select>
          </div>
        `;
        
        const capsulesHtml = years.map(year => {
          const yearAwards = awards.filter(a => a.year === year);
          const boysAwards = sortAwardsByOrder(yearAwards.filter(a => a.gender === 'Boys'));
          const girlsAwards = sortAwardsByOrder(yearAwards.filter(a => a.gender === 'Girls'));
          
          return `
            <div class="awards-year-section" id="awards-year-${year}">
              <h3 class="awards-year-title">${year}</h3>
              <div class="awards-year-grid">
                <div class="awards-gender-card boys">
                  <h4 class="awards-gender-title">Boys</h4>
                  ${boysAwards.length > 0 ? boysAwards.map(a => `
                    <div class="awards-item">
                      <span class="awards-item-award">${a.award}</span>
                      <div class="awards-item-recipient">
                        <img class="awards-item-logo" src="${getTeamLogo(a.school)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                        <div class="awards-item-info">
                          <span class="awards-item-name">${a.name || '(Team)'}</span>
                          <span class="awards-item-school">${a.school}</span>
                        </div>
                      </div>
                    </div>
                  `).join('') : '<div class="awards-empty">No awards</div>'}
                </div>
                <div class="awards-gender-card girls">
                  <h4 class="awards-gender-title">Girls</h4>
                  ${girlsAwards.length > 0 ? girlsAwards.map(a => `
                    <div class="awards-item">
                      <span class="awards-item-award">${a.award}</span>
                      <div class="awards-item-recipient">
                        <img class="awards-item-logo" src="${getTeamLogo(a.school)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                        <div class="awards-item-info">
                          <span class="awards-item-name">${a.name || '(Team)'}</span>
                          <span class="awards-item-school">${a.school}</span>
                        </div>
                      </div>
                    </div>
                  `).join('') : '<div class="awards-empty">No awards</div>'}
                </div>
              </div>
            </div>
          `;
        }).join('');
        
        container.innerHTML = viewToggle + yearDropdown + capsulesHtml;
      } else {
        // List view with search and sorting
        const searchBox = `
          <div class="awards-search-box">
            <input type="text" id="awardsSearch" placeholder="Search by name or school..." value="${awardsSearchTerm}" oninput="filterAwards(this.value)">
          </div>
        `;
        
        // Filter awards
        let filtered = awards;
        if (awardsSearchTerm) {
          const term = awardsSearchTerm.toLowerCase();
          filtered = awards.filter(a => 
            (a.name && a.name.toLowerCase().includes(term)) ||
            (a.school && a.school.toLowerCase().includes(term))
          );
        }
        
        // Sort awards
        filtered.sort((a, b) => {
          let valA = a[awardsSortColumn];
          let valB = b[awardsSortColumn];
          
          if (awardsSortColumn === 'year') {
            valA = parseInt(valA) || 0;
            valB = parseInt(valB) || 0;
          } else {
            valA = (valA || '').toString().toLowerCase();
            valB = (valB || '').toString().toLowerCase();
          }
          
          if (awardsSortDir === 'asc') {
            return valA > valB ? 1 : valA < valB ? -1 : 0;
          } else {
            return valA < valB ? 1 : valA > valB ? -1 : 0;
          }
        });
        
        const sortIcon = (col) => {
          if (awardsSortColumn !== col) return '';
          return awardsSortDir === 'asc' ? ' ' : ' ';
        };
        
        container.innerHTML = viewToggle + searchBox + `
          <table class="bash-history-table sortable-table">
            <thead>
              <tr>
                <th class="sortable" onclick="sortAwards('year')">Year${sortIcon('year')}</th>
                <th class="sortable" onclick="sortAwards('gender')">Division${sortIcon('gender')}</th>
                <th class="sortable" onclick="sortAwards('award')">Award${sortIcon('award')}</th>
                <th class="sortable" onclick="sortAwards('name')">Recipient${sortIcon('name')}</th>
                <th class="sortable" onclick="sortAwards('school')">School${sortIcon('school')}</th>
              </tr>
            </thead>
            <tbody>
              ${filtered.length > 0 ? filtered.map(a => `
                <tr>
                  <td>${a.year}</td>
                  <td>${a.gender}</td>
                  <td>${a.award}</td>
                  <td>${a.name || '(Team)'}</td>
                  <td>
                    <div class="team-cell">
                      <img class="team-logo-small" src="${getTeamLogo(a.school)}" onerror="this.src='/logos/100px/Ball603-white.png'" alt="">
                      <span class="team-name-text">${a.school}</span>
                    </div>
                  </td>
                </tr>
              `).join('') : '<tr><td colspan="5" style="text-align:center;padding:20px;color:#888;">No awards match your search</td></tr>'}
            </tbody>
          </table>
        `;
      }
    }
    
    function setAwardsView(mode) {
      awardsViewMode = mode;
      renderAwards();
    }
    
    function sortAwards(column) {
      if (awardsSortColumn === column) {
        awardsSortDir = awardsSortDir === 'asc' ? 'desc' : 'asc';
      } else {
        awardsSortColumn = column;
        awardsSortDir = column === 'year' ? 'desc' : 'asc';
      }
      renderAwards();
    }
    
    function filterAwards(term) {
      awardsSearchTerm = term;
      renderAwards();
    }
    
    function scrollToAwardsYear(year) {
      if (!year) return;
      const el = document.getElementById('awards-year-' + year);
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', async () => {
      createSnow();
      initTabs();
      initHistory();
      
      // Load stories
      loadBashStories();
      
      // Load teams lookup
      await loadTeamsLookup();
      
      // Load live schedule from database, then initialize schedule display
      await loadLiveSchedule();
      initSchedule();
      initDayGames();
      
      // Update brackets with live scores and advancement
      updateBrackets();
      updateBracketLogos();
      
      // Check banner dismissal
      if (localStorage.getItem('bashBannerDismissed') === 'true') {
        document.getElementById('continueBanner').style.display = 'none';
      }
    });
  </script>
</body>
</html>