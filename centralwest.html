<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Manchester Central-West Girls Basketball - Schedule, Roster, News, and Galleries on Ball603">
  <meta name="theme-color" content="#003366">
  <title>Manchester Central-West | Ball603</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/logo.png">
  <link rel="apple-touch-icon" href="/logo.png">
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S4BN80729K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S4BN80729K');
  </script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0"></script>
  
  <!-- Shared Styles -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/team.css">
  
  <!-- Navigation Loader -->
  <script src="/includes/nav-loader.js" defer></script>
  
  <!-- Open Graph -->
  <meta property="og:title" content="Manchester Central-West | Ball603">
  <meta property="og:description" content="Manchester Central-West Girls Basketball Coverage">
  <meta property="og:image" content="https://ball603.com/logo.png">
  <meta property="og:url" content="https://ball603.com/centralwest">
  
  <!-- Team-specific CSS Variables -->
  <style>
    :root {
      --team-primary: #003366;
      --team-secondary: #FFD700;
      --team-accent: #4d7ab3;
    }
    
    /* Hide boys-only elements */
    .boys-stats,
    #boysRosterCard,
    .schedule-card:first-child {
      display: none !important;
    }
    
    /* Make girls schedule full width */
    .schedules-grid {
      grid-template-columns: 1fr !important;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Make girls roster full width */
    .rosters-grid {
      grid-template-columns: 1fr !important;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Adjust quick stats for girls only */
    .team-quick-stats {
      justify-content: center;
    }
    
    .girls-stats {
      max-width: 500px;
    }
  </style>
</head>
<body class="team-page">
  
  <!-- Header loaded from includes -->
  <div id="site-header"></div>
  
  <!-- Mobile menu loaded from includes -->
  <div id="mobile-menu"></div>

  <!-- Hero Section -->
  <section class="team-hero" id="teamHero">
    <div class="team-hero-bg"></div>
    <div class="particles-container" id="particlesContainer"></div>
    <div class="team-hero-content">
      <div class="team-hero-tagline" id="teamTagline">CENTRAL-WEST GIRLS BASKETBALL</div>
      <div class="team-hero-logo-wrap">
        <img src="/logos/200px/CentralWest.png" alt="Central-West Logo" class="team-hero-logo" id="teamLogo" onerror="this.src='/logo.png'">
      </div>
      <div class="team-hero-meta" id="teamMeta">Manchester, NH</div>
      <div class="team-hero-stats" id="heroStats"></div>
    </div>
  </section>

  <!-- Menu Bar -->
  <nav class="team-menu-bar">
    <div class="team-menu-inner">
      <a href="#news" class="team-menu-item" data-section="news">
        <span class="menu-icon">ðŸ“°</span>
        <span class="menu-text">News</span>
      </a>
      <a href="#galleries" class="team-menu-item" data-section="galleries">
        <span class="menu-icon">ðŸ“·</span>
        <span class="menu-text">Galleries</span>
      </a>
      <a href="#schedules" class="team-menu-item" data-section="schedules">
        <span class="menu-icon">ðŸ“…</span>
        <span class="menu-text">Schedules</span>
      </a>
      <a href="#rosters" class="team-menu-item" data-section="rosters">
        <span class="menu-icon">ðŸ‘¥</span>
        <span class="menu-text">Rosters</span>
      </a>
    </div>
  </nav>

  <!-- Quick Stats Bar (Girls Only) -->
  <section class="team-quick-stats" id="quickStats">
    <div class="quick-stats-group girls-stats">
      <div class="quick-stats-label">GIRLS</div>
      <div class="quick-stats-data">
        <div class="quick-stat">
          <span class="quick-stat-label">Record</span>
          <span class="quick-stat-value" id="girlsRecord">--</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-label">Last Result</span>
          <span class="quick-stat-value" id="girlsLastResult">--</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-label">Next Game</span>
          <span class="quick-stat-value" id="girlsNextGame">--</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="team-main">
    
    <!-- NEWS SECTION -->
    <section class="team-section" id="news">
      <div class="section-header">
        <h2 class="section-title">ðŸ“° Latest News</h2>
        <a href="/news?team=central-west" class="section-link" id="newsViewAllLink">View All â†’</a>
      </div>
      <div class="stories-featured" id="storiesFeatured">
        <div class="empty-state"><p>No stories yet. Check back soon!</p></div>
      </div>
    </section>

    <!-- GALLERIES SECTION -->
    <section class="team-section" id="galleries">
      <div class="section-header">
        <h2 class="section-title">ðŸ“· Photo Galleries</h2>
      </div>
      <div class="galleries-container">
        <button class="gallery-arrow gallery-arrow-left" id="galleryArrowLeft" aria-label="Scroll left">â€¹</button>
        <div class="galleries-scroll" id="galleriesGrid">
          <div class="empty-state"><p>Loading galleries...</p></div>
        </div>
        <button class="gallery-arrow gallery-arrow-right" id="galleryArrowRight" aria-label="Scroll right">â€º</button>
      </div>
    </section>

    <!-- SPONSOR SECTION -->
    <section class="team-section team-sponsor-section" id="sponsor">
      <div class="team-sponsor" id="sponsorBox">
        <a href="mailto:kj@ball603.com?subject=Team%20Sponsorship%20Inquiry%20-%20Central-West" class="sponsor-link sponsor-fallback" id="sponsorFallbackLink">
          <img src="/logo.png" alt="Ball603" class="sponsor-logo-img">
          <div class="sponsor-fallback-text">
            <div class="sponsor-fallback-line1" id="sponsorFallbackLine1">Enjoying our coverage?</div>
            <div class="sponsor-fallback-line2">Click to inquire about becoming the official team sponsor</div>
          </div>
        </a>
      </div>
    </section>

    <!-- SCHEDULES SECTION -->
    <section class="team-section" id="schedules">
      <div class="section-header">
        <h2 class="section-title">ðŸ“… Schedule</h2>
      </div>
      <div class="schedules-grid">
        <div class="schedule-card">
          <div class="schedule-card-header girls">
            <span class="schedule-card-label">Girls Varsity</span>
            <span class="schedule-card-record" id="girlsRecordCard">--</span>
          </div>
          <div class="schedule-card-games" id="girlsScheduleGames">
            <div class="empty-state"><p>Loading schedule...</p></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ROSTERS SECTION -->
    <section class="team-section" id="rosters">
      <div class="section-header">
        <h2 class="section-title">ðŸ‘¥ Roster</h2>
      </div>
      <div class="rosters-grid">
        <div class="roster-card" id="girlsRosterCard">
          <div class="roster-card-header girls">
            <span class="roster-card-label">Girls Varsity</span>
            <span class="roster-card-count" id="girlsRosterCount">--</span>
          </div>
          <div class="roster-card-body" id="girlsRosterBody">
            <div class="roster-empty"><p>Loading roster...</p></div>
          </div>
          <div class="roster-card-coach" id="girlsCoachInfo"></div>
        </div>
      </div>
    </section>

  </main>

  <!-- Site Footer -->
  <footer class="site-footer">
    <div class="footer-logo"><img src="/logo.png" alt="Ball603"></div>
    <div class="footer-links">
      <a href="/about">About Us</a>
      <a href="/contact">Contact</a>
    </div>
    <div class="footer-social">
      <a href="https://facebook.com/ball603" target="_blank" title="Facebook"><svg viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg></a>
      <a href="https://www.instagram.com/ball603nh/" target="_blank" title="Instagram"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg></a>
      <a href="https://x.com/Ball603NH" target="_blank" title="X (Twitter)"><svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
    </div>
    <p class="footer-copyright">&copy; 2025 Ball603. All rights reserved.</p>
  </footer>

  <script>
    // ===== SUPABASE CLIENT =====
    const SUPABASE_URL = 'https://suncdkxfqkwwnmhosxcf.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1bmNka3hmcWt3d25taG9zeGNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNTk4MzIsImV4cCI6MjA4MDYzNTgzMn0.aT6V8Zx_YozqOh1ZnC6x-czI9vo-QhHKmP69PgY-8xw';
    const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ===== HARDCODED TEAM CONFIG FOR CENTRAL-WEST =====
    const TEAM_CONFIG = {
      slug: 'centralwest',
      name: 'Central-West',
      shortname: 'Central-West',
      mascot: '',
      fullName: 'Manchester Central-West',
      town: 'Manchester',
      state: 'NH',
      colors: {
        primary: '#003366',
        secondary: '#FFD700',
        accent: '#4d7ab3'
      },
      logo: '/logos/200px/CentralWest.png',
      logoFilename: 'CentralWest',
      nameVariations: ['Central-West', 'Manchester Central-West', 'Central West', 'CentralWest']
    };

    // ===== STATE =====
    let teamData = {
      rosters: { girls: null },
      schedules: { girls: [] },
      galleries: []
    };

    // ===== UTILITIES =====
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr + 'T12:00:00');
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function formatShortDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr + 'T12:00:00');
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    function formatTime(timeStr) {
      if (!timeStr) return 'TBD';
      const [h, m] = timeStr.split(':').map(Number);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const hour = h % 12 || 12;
      return `${hour}:${String(m).padStart(2, '0')} ${ampm}`;
    }

    // ===== ARTICLE DATE HELPERS =====
    function getArticleDateString(article) {
      if (article.article_date) return article.article_date;
      if (article.published_at) return article.published_at.split('T')[0];
      return '1970-01-01';
    }
    
    function getArticleDisplayDate(article) {
      return article.article_date || article.published_at || null;
    }

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', async () => {
      // Set team colors
      document.documentElement.style.setProperty('--team-primary', TEAM_CONFIG.colors.primary);
      document.documentElement.style.setProperty('--team-secondary', TEAM_CONFIG.colors.secondary);
      document.documentElement.style.setProperty('--team-accent', TEAM_CONFIG.colors.accent);
      
      // Set hero background
      const hero = document.getElementById('teamHero');
      if (hero) {
        hero.style.background = `linear-gradient(135deg, ${TEAM_CONFIG.colors.primary} 0%, ${TEAM_CONFIG.colors.secondary} 100%)`;
      }
      
      initMenuNavigation();
      createParticles();
      
      await Promise.all([
        loadRosters(),
        loadSchedules(),
        loadGalleries(),
        loadArticles()
      ]);
    });

    // ===== MENU NAVIGATION =====
    function initMenuNavigation() {
      document.querySelectorAll('.team-menu-item').forEach(item => {
        item.addEventListener('click', (e) => {
          const href = item.getAttribute('href');
          if (href && href.startsWith('#')) {
            e.preventDefault();
            const section = document.querySelector(href);
            if (section) {
              const menuBar = document.querySelector('.team-menu-bar');
              const offset = menuBar ? menuBar.offsetHeight + 20 : 80;
              window.scrollTo({ top: section.offsetTop - offset, behavior: 'smooth' });
            }
          }
        });
      });
    }

    // ===== PARTICLES =====
    function createParticles() {
      const container = document.getElementById('particlesContainer');
      if (!container) return;
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 10 + 's';
        particle.style.animationDuration = (10 + Math.random() * 20) + 's';
        container.appendChild(particle);
      }
    }

    // ===== LOAD ROSTERS =====
    async function loadRosters() {
      try {
        const response = await fetch(`/.netlify/functions/get-rosters?school=${encodeURIComponent('Central-West')}`);
        const data = await response.json();
        teamData.rosters.girls = data.girls || null;
        renderRosters();
      } catch (err) { console.error('Error loading rosters:', err); renderRosterError(); }
    }

    function renderRosters() {
      renderRosterCard('girls', teamData.rosters.girls);
    }

    function renderRosterCard(gender, roster) {
      const bodyEl = document.getElementById(`${gender}RosterBody`);
      const countEl = document.getElementById(`${gender}RosterCount`);
      const coachEl = document.getElementById(`${gender}CoachInfo`);
      
      if (!roster || !roster.players || roster.players.length === 0) {
        bodyEl.innerHTML = `<div class="roster-empty"><p>No roster submitted yet.</p><p><a href="mailto:kj@ball603.com?subject=Roster%20Submission%20-%20Central-West%20Girls">Submit Now</a></p></div>`;
        if (countEl) countEl.textContent = '0 players';
        return;
      }
      
      if (countEl) countEl.textContent = `${roster.players.length} players`;
      
      // Sort by number
      const sorted = [...roster.players].sort((a, b) => {
        const numA = parseInt(a.number) || 999;
        const numB = parseInt(b.number) || 999;
        return numA - numB;
      });
      
      bodyEl.innerHTML = `
        <table class="roster-table">
          <thead><tr><th>#</th><th>Name</th><th>Pos</th><th>Yr</th><th>Ht</th></tr></thead>
          <tbody>
            ${sorted.map(p => `
              <tr>
                <td>${p.number || '-'}</td>
                <td>${p.name || '-'}</td>
                <td>${p.position || '-'}</td>
                <td>${p.year || '-'}</td>
                <td>${p.height || '-'}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      if (coachEl && roster.coach) {
        coachEl.innerHTML = `<div class="coach-info">&#127942; Head Coach: ${roster.coach}</div>`;
      }
    }

    function renderRosterError() {
      document.getElementById('girlsRosterBody').innerHTML = '<div class="roster-empty"><p>Unable to load roster</p></div>';
    }

    // ===== LOAD SCHEDULES =====
    async function loadSchedules() {
      try {
        const response = await fetch('/.netlify/functions/get-games');
        const data = await response.json();
        const allGames = data.games || [];
        
        const teamNames = TEAM_CONFIG.nameVariations;
        const teamGames = allGames.filter(g => {
          const home = g.home || g.home_team || '';
          const away = g.away || g.away_team || '';
          return teamNames.some(n => n && (home.includes(n) || away.includes(n)));
        });
        
        teamData.schedules.girls = teamGames.filter(g => g.gender === 'Girls');
        console.log(`Schedule loaded: ${teamData.schedules.girls.length} girls games`);
        renderSchedules();
      } catch (err) { console.error('Error loading schedules:', err); renderScheduleError(); }
    }

    function renderSchedules() {
      renderScheduleCard('girls', teamData.schedules.girls);
    }

    function renderScheduleCard(gender, games) {
      const container = document.getElementById(`${gender}ScheduleGames`);
      const recordEl = document.getElementById(`${gender}RecordCard`);
      const quickRecordEl = document.getElementById(`${gender}Record`);
      const nextGameEl = document.getElementById(`${gender}NextGame`);
      const lastResultEl = document.getElementById(`${gender}LastResult`);
      
      if (!games || games.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No games scheduled yet</p></div>';
        if (recordEl) recordEl.textContent = '0-0';
        if (quickRecordEl) quickRecordEl.textContent = '0-0';
        if (nextGameEl) nextGameEl.textContent = '--';
        if (lastResultEl) lastResultEl.textContent = '--';
        return;
      }
      
      const teamNames = TEAM_CONFIG.nameVariations;
      const isThisTeam = (name) => teamNames.some(n => n && name?.includes(n));
      games.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      let wins = 0, losses = 0;
      const completedGames = [], upcomingGames = [];
      const today = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/New_York' }));
      today.setHours(0, 0, 0, 0);
      
      games.forEach(g => {
        const gameDate = new Date(g.date + 'T12:00:00-05:00'); gameDate.setHours(0, 0, 0, 0);
        const home = g.home || g.home_team || '';
        const away = g.away || g.away_team || '';
        const isHome = isThisTeam(home);
        const hs = String(g.home_score || '').trim(), as = String(g.away_score || '').trim();
        const hasScore = hs !== '' && as !== '';
        if (hasScore) {
          const homeScore = parseInt(hs), awayScore = parseInt(as);
          const teamScore = isHome ? homeScore : awayScore, oppScore = isHome ? awayScore : homeScore;
          const won = teamScore > oppScore;
          if (won) wins++; else losses++;
          completedGames.push({ ...g, home, away, isHome, teamScore, oppScore, won });
        } else if (gameDate >= today) { upcomingGames.push({ ...g, home, away, isHome }); }
      });
      
      const record = `${wins}-${losses}`;
      if (recordEl) recordEl.textContent = record;
      if (quickRecordEl) quickRecordEl.textContent = record;
      if (nextGameEl) {
        if (upcomingGames.length > 0) {
          const next = upcomingGames[0], opp = next.isHome ? next.away : next.home;
          nextGameEl.textContent = `${formatShortDate(next.date)} ${next.isHome ? 'vs' : '@'} ${opp}`;
        } else nextGameEl.textContent = '--';
      }
      if (lastResultEl) {
        if (completedGames.length > 0) {
          const last = completedGames[completedGames.length - 1], opp = last.isHome ? last.away : last.home;
          lastResultEl.textContent = `${last.won ? 'W' : 'L'} ${last.teamScore}-${last.oppScore} ${last.isHome ? 'vs' : '@'} ${opp}`;
        } else lastResultEl.textContent = '--';
      }
      
      const allGames = games.map(g => {
        const home = g.home || g.home_team || '';
        const away = g.away || g.away_team || '';
        const isHome = isThisTeam(home);
        const hs = String(g.home_score || '').trim(), as = String(g.away_score || '').trim();
        const hasScore = hs !== '' && as !== '';
        let teamScore, oppScore, won;
        if (hasScore) {
          const homeScore = parseInt(hs), awayScore = parseInt(as);
          teamScore = isHome ? homeScore : awayScore; oppScore = isHome ? awayScore : homeScore;
          won = teamScore > oppScore;
        }
        return { ...g, home, away, isHome, teamScore, oppScore, won, hasScore };
      });
      
      container.innerHTML = allGames.map(g => {
        const opp = g.isHome ? g.away : g.home;
        let resultClass = 'upcoming', resultText = formatTime(g.time);
        if (g.hasScore) { resultClass = g.won ? 'win' : 'loss'; resultText = `${g.won ? 'W' : 'L'} ${g.teamScore}-${g.oppScore}`; }
        return `
          <div class="schedule-game ${resultClass}">
            <div class="schedule-game-date">${formatShortDate(g.date)}</div>
            <div class="schedule-game-opponent">${g.isHome ? 'vs' : '@'} ${opp}</div>
            <div class="schedule-game-result ${resultClass}">${resultText}</div>
          </div>
        `;
      }).join('');
    }

    function renderScheduleError() {
      document.getElementById('girlsScheduleGames').innerHTML = '<div class="empty-state"><p>Unable to load schedule</p></div>';
    }

    // ===== LOAD GALLERIES =====
    async function loadGalleries() {
      try {
        const { data: albums } = await db.from('smugmug_albums').select('*').order('image_count', { ascending: false });
        if (!albums) return;
        
        const teamNames = TEAM_CONFIG.nameVariations;
        const matchingAlbums = albums.filter(a => {
          const title = (a.name || '').toLowerCase();
          return teamNames.some(v => v && title.includes(v.toLowerCase()));
        });
        
        // Also check manual gallery assignments
        const { data: manualGalleries } = await db.from('team_galleries').select('album_key').eq('team_slug', 'centralwest');
        const manualKeys = (manualGalleries || []).map(g => g.album_key);
        const manualAlbums = albums.filter(a => manualKeys.includes(a.album_key));
        
        teamData.galleries = [...new Map([...matchingAlbums, ...manualAlbums].map(a => [a.album_key, a])).values()];
        renderGalleries();
      } catch (err) { console.error('Error loading galleries:', err); }
    }

    function renderGalleries() {
      const container = document.getElementById('galleriesGrid');
      const galleries = teamData.galleries;
      
      if (!galleries || galleries.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No galleries yet. Check back soon!</p></div>';
        return;
      }
      
      container.innerHTML = galleries.slice(0, 12).map(g => `
        <a href="${g.web_url}" target="_blank" class="gallery-card">
          <div class="gallery-card-image" style="background-image: url('${g.cover_image_url || '/logo.png'}');">
            <div class="gallery-card-count">&#128247; ${g.image_count || 0}</div>
          </div>
          <div class="gallery-card-title">${g.name}</div>
        </a>
      `).join('');
      
      initGalleryArrows();
    }

    function initGalleryArrows() {
      const scroll = document.getElementById('galleriesGrid');
      const leftBtn = document.getElementById('galleryArrowLeft');
      const rightBtn = document.getElementById('galleryArrowRight');
      if (!scroll || !leftBtn || !rightBtn) return;
      
      leftBtn.addEventListener('click', () => scroll.scrollBy({ left: -300, behavior: 'smooth' }));
      rightBtn.addEventListener('click', () => scroll.scrollBy({ left: 300, behavior: 'smooth' }));
    }

    // ===== LOAD ARTICLES =====
    async function loadArticles() {
      try {
        const { data: articles, error } = await db.from('articles').select('*').eq('status', 'published');
        if (error) throw error;
        
        const teamTagNormalized = 'centralwest';
        const teamArticles = (articles || []).filter(a => {
          if (!a.tags) return false;
          const tagArray = Array.isArray(a.tags) ? a.tags : JSON.parse(a.tags || '[]');
          return tagArray.some(tag => tag.toLowerCase().replace(/[^a-z0-9]/g, '') === teamTagNormalized);
        });
        
        teamArticles.sort((a, b) => {
          const dateA = getArticleDateString(a);
          const dateB = getArticleDateString(b);
          return dateB.localeCompare(dateA);
        });
        
        renderArticles(teamArticles.slice(0, 6));
      } catch (err) { console.error('Error loading articles:', err); }
    }

    function renderArticles(articles) {
      const container = document.getElementById('storiesFeatured');
      if (!articles || articles.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>No stories yet. Check back soon!</p></div>';
        return;
      }
      const featured = articles[0], secondary = articles.slice(1, 6);
      const featuredPhotog = featured.photographer || featured.game_data?.photographerName || featured.featured_image_caption || '';
      container.innerHTML = `
        <a href="/article/${featured.slug}" class="story-box-large">
          <div class="story-box-image" style="background-image: url('${featured.featured_image_url || '/images/placeholder.jpg'}');">
            ${featuredPhotog ? `<div class="photo-credit">&#128247; ${featuredPhotog}</div>` : ''}
          </div>
          <div class="story-box-content">
            <h3 class="story-box-title">${featured.title}</h3>
            <span class="story-box-date">&#128197; ${formatDate(getArticleDisplayDate(featured))}</span>
          </div>
        </a>
        ${secondary.length > 0 ? `<div class="story-box-stack">${secondary.map(a => {
          const photog = a.photographer || a.game_data?.photographerName || a.featured_image_caption || '';
          return `
            <a href="/article/${a.slug}" class="story-box-small">
              <div class="story-box-image" style="background-image: url('${a.featured_image_url || '/images/placeholder.jpg'}');">
                ${photog ? `<div class="photo-credit">&#128247; ${photog}</div>` : ''}
              </div>
              <div class="story-box-content"><h4 class="story-box-title">${a.title}</h4><span class="story-box-date">&#128197; ${formatDate(getArticleDisplayDate(a))}</span></div>
            </a>`;
        }).join('')}</div>` : ''}
      `;
    }
  </script>

</body>
</html>
